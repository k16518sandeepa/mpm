<!DOCTYPE html>
<html>
<head>
  <title>MPM Admin - Manage Comments</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial;
      background: #111;
      color: white;
      padding: 20px;
    }

    h1 { text-align: center; }

    .login-box {
      max-width: 400px;
      margin: 80px auto;
      text-align: center;
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
    }

    button {
      padding: 8px 15px;
      background: #ff4757;
      border: none;
      color: white;
      cursor: pointer;
      margin-top: 6px;
    }

    .approve-btn { background: green; }
    .delete-btn { background: red; }

    .comment-card {
      background: #222;
      padding: 15px;
      margin-top: 15px;
      border-radius: 8px;
    }

    .meta {
      font-size: 13px;
      opacity: 0.7;
    }

    #dashboard { display: none; }
  </style>
</head>
<body>

<h1>MPM Comment Management</h1>

<div class="login-box" id="loginBox">
  <h3>Admin Login</h3>
  <input type="password" id="adminPass" placeholder="Enter Admin Password">
  <button onclick="login()">Login</button>
</div>

<div id="dashboard">
  <h2>All Comments</h2>
  <div id="commentsContainer"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  query, 
  orderBy, 
  onSnapshot, 
  doc, 
  deleteDoc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDGmr14fH5_eIhRzaQ985TFExk3OnFI_To",
  authDomain: "motionpicturemafia-471cc.firebaseapp.com",
  projectId: "motionpicturemafia-471cc",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const ADMIN_PASSWORD = "mpmadmin123";

// Simple login
window.login = function () {
  const pass = document.getElementById("adminPass").value;

  if (pass === ADMIN_PASSWORD) {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("dashboard").style.display = "block";
  } else {
    alert("Wrong password!");
  }
};

const q = query(collection(db, "comments"), orderBy("created", "desc"));

onSnapshot(q, (snapshot) => {
  const container = document.getElementById("commentsContainer");
  container.innerHTML = "";

  snapshot.forEach((docData) => {
    const data = docData.data();
    const id = docData.id;

    container.innerHTML += `
      <div class="comment-card">
        <div class="meta">
          <strong>Article:</strong> ${data.articleId}<br>
          <strong>Name:</strong> ${data.name}<br>
          <strong>Status:</strong> ${data.approved ? "✅ Approved" : "⏳ Pending"}<br>
          <strong>Likes:</strong> ${data.likes || 0}
        </div>
        <p>${data.comment}</p>

        ${
          !data.approved 
          ? `<button class="approve-btn" onclick="approveComment('${id}')">Approve</button>` 
          : ""
        }

        <button class="delete-btn" onclick="deleteComment('${id}')">
          Delete
        </button>
      </div>
    `;
  });
});

window.approveComment = async function (id) {
  await updateDoc(doc(db, "comments", id), {
    approved: true
  });
};

window.deleteComment = async function (id) {
  if (confirm("Delete this comment?")) {
    await deleteDoc(doc(db, "comments", id));
  }
};
</script>

</body>
</html>
